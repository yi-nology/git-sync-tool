import{v as I,k as O,D as E,G as d,E as a,F as l,S as r,u as m,r as i,ac as o,y as v,am as A,P as R,z as P,U as u,ad as j}from"./vendor-BwpG93hR.js";import{x as F,J as G,j as $}from"./element-plus-BS7CnCwq.js";import{s as q}from"./request-BBaptrTN.js";import{f as H}from"./format-B53pSo0L.js";import{_ as Q}from"./index-Bev_lS0N.js";function W(k){return q.get("/audit/logs",{params:k})}const X={class:"audit-log-page"},Z={class:"page-header"},ee={class:"filter-bar"},te={key:1},ae={class:"pagination-bar"},le={class:"detail-content"},g=20,oe=I({__name:"AuditLogPage",setup(k){const y=i(!1),x=i([]),_=i(0),p=i(1),b=i(""),h=i(""),f=i(null),C=i(!1),V=i("");function U(n){return n==="CREATE"?"success":n==="DELETE"?"danger":n==="UPDATE"?"warning":"info"}O(()=>{s()});async function s(){y.value=!0;try{const n=await W({page:p.value,page_size:g,action:b.value||void 0,target:h.value||void 0,start_date:f.value?.[0]||void 0,end_date:f.value?.[1]||void 0});x.value=n.items||[],_.value=n.total||0}finally{y.value=!1}}function T(n){try{V.value=JSON.stringify(JSON.parse(n),null,2)}catch{V.value=n}C.value=!0}return(n,t)=>{const L=o("el-icon"),w=o("el-button"),D=o("el-input"),N=o("el-date-picker"),c=o("el-table-column"),S=o("el-tag"),z=o("el-text"),B=o("el-table"),M=o("el-pagination"),Y=o("el-card"),J=o("el-dialog"),K=j("loading");return v(),E("div",X,[d("div",Z,[d("h2",null,[a(L,null,{default:l(()=>[a(m(G))]),_:1}),t[5]||(t[5]=r(" 操作审计日志",-1))]),a(w,{onClick:s,icon:m(F)},{default:l(()=>[...t[6]||(t[6]=[r("刷新",-1)])]),_:1},8,["icon"])]),a(Y,null,{default:l(()=>[d("div",ee,[a(D,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=e=>b.value=e),placeholder:"操作类型",clearable:"",style:{width:"140px"},onClear:s,onKeyup:A(s,["enter"])},null,8,["modelValue"]),a(D,{modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=e=>h.value=e),placeholder:"目标对象",clearable:"",style:{width:"200px"},onClear:s,onKeyup:A(s,["enter"])},null,8,["modelValue"]),a(N,{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=e=>f.value=e),type:"daterange","range-separator":"~","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"280px"},onChange:s},null,8,["modelValue"]),a(w,{type:"primary",onClick:s,icon:m($)},{default:l(()=>[...t[7]||(t[7]=[r("搜索",-1)])]),_:1},8,["icon"])]),R((v(),P(B,{data:x.value,stripe:"",border:""},{default:l(()=>[a(c,{prop:"created_at",label:"时间",width:"180"},{default:l(({row:e})=>[r(u(m(H)(e.created_at)),1)]),_:1}),a(c,{prop:"action",label:"操作类型",width:"120"},{default:l(({row:e})=>[a(S,{size:"small",type:U(e.action)},{default:l(()=>[r(u(e.action),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"target",label:"目标对象","min-width":"200"}),a(c,{label:"操作人 / IP",width:"200"},{default:l(({row:e})=>[d("div",null,u(e.operator||"-"),1),a(z,{type:"info",size:"small"},{default:l(()=>[r(u(e.ip_address),1)]),_:2},1024)]),_:1}),a(c,{label:"详情",width:"100"},{default:l(({row:e})=>[e.details?(v(),P(w,{key:0,size:"small",link:"",onClick:ne=>T(e.details)},{default:l(()=>[...t[8]||(t[8]=[r("查看",-1)])]),_:1},8,["onClick"])):(v(),E("span",te,"-"))]),_:1})]),_:1},8,["data"])),[[K,y.value]]),d("div",ae,[a(z,{type:"info",size:"small"},{default:l(()=>[r(" 显示 "+u((p.value-1)*g+1)+" - "+u(Math.min(p.value*g,_.value))+" 共 "+u(_.value)+" 条 ",1)]),_:1}),a(M,{"current-page":p.value,"onUpdate:currentPage":t[3]||(t[3]=e=>p.value=e),"page-size":g,total:_.value,layout:"prev, pager, next",onCurrentChange:s,small:""},null,8,["current-page","total"])])]),_:1}),a(J,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=e=>C.value=e),title:"操作详情",width:"600px"},{default:l(()=>[d("pre",le,u(V.value),1)]),_:1},8,["modelValue"])])}}}),pe=Q(oe,[["__scopeId","data-v-0c5408fa"]]);export{pe as default};
