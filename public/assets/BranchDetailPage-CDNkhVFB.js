import{v as se,k as oe,P as ue,D as f,G as v,E as e,F as a,u as m,U as p,z,R,az as ne,r as c,ac as u,ad as re,y as i,S as o,M as T,a6 as G,c as ie,aB as de}from"./vendor-BwpG93hR.js";import{e as me,g as ce,t as fe,y as pe,r as _e,a as ve,b as D,z as he,E as ye}from"./element-plus-BS7CnCwq.js";import{g as ge,f as be,h as we}from"./branch-DTLR2Pkm.js";import{a as ke,s as Ve}from"./repo-DyMh5937.js";import{b as Ce,c as xe}from"./stats-DRnY4cEJ.js";import{a as ze,b as De,s as $e}from"./system-IA1MElDq.js";import{a as Be}from"./format-B53pSo0L.js";import{_ as Se}from"./index-Bev_lS0N.js";import"./request-BBaptrTN.js";const Re={class:"branch-detail-page"},Ue={class:"page-header"},Ne={class:"header-left"},Ee={class:"header-actions"},Pe={class:"status-text"},Ae={key:0},Me={key:1,class:"commit-list"},Fe={class:"commit-main"},Te={class:"commit-meta"},Ge={key:0},Ke={key:1,class:"author-list"},Le={class:"author-info"},je=se({__name:"BranchDetailPage",setup(qe){const K=ne(),H=de(),d=K.params.repoKey,_=K.params.branchName,U=c(!1),N=c(!1),h=c(null),$=c([]),E=c([]),B=c(""),P=c(!1),k=c(!1),V=c([]),C=c(!1),A=c(!1),n=c({author_name:"",author_email:"",message:"",push:!1}),J=ie(()=>{if(!h.value?.authors)return 0;const s=new Set;for(const t of h.value.authors)t.file_types&&Object.keys(t.file_types).forEach(r=>s.add(r));return s.size});oe(()=>M());async function M(){U.value=!0;try{try{const t=((await ge(d,{type:"local",page_size:500})).list||[]).find(r=>r.name===_);N.value=t?.is_current||!1}catch{}try{h.value=await Ce(d,{branch:_})}catch{}try{const s=await xe(d,{branch:_});$.value=(Array.isArray(s)?s:[]).slice(0,20)}catch{}try{const s=await ke(d);if(s?.path){const t=await Ve(s.path);E.value=(t.remotes||[]).map(r=>r.name)}}catch{}try{const s=await ze(d);B.value=s?.status||"",P.value=!!B.value&&B.value.trim()!==""}catch{}try{const s=await De(d);n.value.author_name=s?.name||"",n.value.author_email=s?.email||""}catch{}}finally{U.value=!1}}function Q(){const s=E.value[0];V.value=s?[s]:[],k.value=!0}async function W(){if(!V.value.length){D.warning("请选择目标远端");return}try{await be(d,_,V.value),D.success("推送成功"),k.value=!1}catch{}}async function X(){try{await ye.confirm(`确定要删除分支 "${_}" 吗？`,"确认删除",{type:"warning"}),await we(d,_),D.success("分支已删除"),H.push(`/repos/${d}/branches`)}catch{}}async function Y(){if(!n.value.message){D.warning("请输入提交信息");return}A.value=!0;try{await $e({repo_key:d,message:n.value.message,push:n.value.push,author_name:n.value.author_name||void 0,author_email:n.value.author_email||void 0}),D.success("提交成功"),C.value=!1,await M()}finally{A.value=!1}}return(s,t)=>{const r=u("el-button"),L=u("el-tag"),y=u("el-icon"),Z=u("el-alert"),S=u("el-statistic"),g=u("el-card"),b=u("el-col"),j=u("el-row"),q=u("el-empty"),w=u("el-text"),ee=u("el-checkbox"),te=u("el-checkbox-group"),x=u("el-form-item"),I=u("el-form"),O=u("el-dialog"),F=u("el-input"),ae=u("el-switch"),le=re("loading");return ue((i(),f("div",Re,[v("div",Ue,[v("div",Ne,[e(r,{onClick:t[0]||(t[0]=l=>s.$router.push(`/repos/${m(d)}/branches`)),icon:m(me),text:""},{default:a(()=>[...t[12]||(t[12]=[o("返回",-1)])]),_:1},8,["icon"]),v("h2",null,p(m(_)),1),N.value?(i(),z(L,{key:0,type:"success",size:"small"},{default:a(()=>[...t[13]||(t[13]=[o("当前分支",-1)])]),_:1})):R("",!0)]),v("div",Ee,[e(r,{type:"primary",onClick:t[1]||(t[1]=l=>s.$router.push(`/repos/${m(d)}/compare`))},{default:a(()=>[e(y,null,{default:a(()=>[e(m(ce))]),_:1}),t[14]||(t[14]=o(" 对比/合并 ",-1))]),_:1}),e(r,{type:"success",onClick:Q},{default:a(()=>[e(y,null,{default:a(()=>[e(m(fe))]),_:1}),t[15]||(t[15]=o(" 推送远端 ",-1))]),_:1}),P.value?(i(),z(r,{key:0,type:"warning",onClick:t[2]||(t[2]=l=>C.value=!0)},{default:a(()=>[e(y,null,{default:a(()=>[e(m(pe))]),_:1}),t[16]||(t[16]=o(" 提交变更 ",-1))]),_:1})):R("",!0),e(r,{onClick:M},{default:a(()=>[e(y,null,{default:a(()=>[e(m(_e))]),_:1}),t[17]||(t[17]=o(" 刷新 ",-1))]),_:1}),N.value?R("",!0):(i(),z(r,{key:1,type:"danger",onClick:X},{default:a(()=>[e(y,null,{default:a(()=>[e(m(ve))]),_:1}),t[18]||(t[18]=o(" 删除分支 ",-1))]),_:1}))])]),P.value?(i(),z(Z,{key:0,title:"检测到未提交的变更",type:"warning",closable:!1,"show-icon":"",class:"mb-4"},{default:a(()=>[v("pre",Pe,p(B.value),1)]),_:1})):R("",!0),e(j,{gutter:16,class:"mb-4"},{default:a(()=>[e(b,{span:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[e(S,{title:"总代码行数",value:h.value?.total_lines||0},null,8,["value"])]),_:1})]),_:1}),e(b,{span:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[e(S,{title:"提交总数",value:$.value.length},null,8,["value"])]),_:1})]),_:1}),e(b,{span:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[e(S,{title:"贡献者数",value:h.value?.authors?.length||0},null,8,["value"])]),_:1})]),_:1}),e(b,{span:6},{default:a(()=>[e(g,{shadow:"hover"},{default:a(()=>[e(S,{title:"文件类型",value:J.value},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(j,{gutter:16},{default:a(()=>[e(b,{span:16},{default:a(()=>[e(g,{header:"最近提交"},{default:a(()=>[$.value.length===0?(i(),f("div",Ae,[e(q,{description:"暂无提交记录"})])):(i(),f("div",Me,[(i(!0),f(T,null,G($.value,l=>(i(),f("div",{key:l.hash,class:"commit-item"},[v("div",Fe,[e(w,{class:"commit-message",truncated:""},{default:a(()=>[o(p(l.message),1)]),_:2},1024),v("div",Te,[e(w,{type:"info",size:"small"},{default:a(()=>[e(y,null,{default:a(()=>[e(m(he))]),_:1}),o(" "+p(l.author),1)]),_:2},1024),e(w,{type:"info",size:"small"},{default:a(()=>[o(p(m(Be)(l.date)),1)]),_:2},1024),e(w,{class:"mono-text",size:"small",type:"info"},{default:a(()=>[o(p(l.hash?.substring(0,8)),1)]),_:2},1024)])])]))),128))]))]),_:1})]),_:1}),e(b,{span:8},{default:a(()=>[e(g,{header:"贡献者排行"},{default:a(()=>[h.value?.authors?.length?(i(),f("div",Ke,[(i(!0),f(T,null,G(h.value.authors,l=>(i(),f("div",{key:l.email,class:"author-item"},[v("div",Le,[e(w,{class:"author-name"},{default:a(()=>[o(p(l.name),1)]),_:2},1024),e(w,{type:"info",size:"small"},{default:a(()=>[o(p(l.email),1)]),_:2},1024)]),e(L,{size:"small",type:"success"},{default:a(()=>[o(p(l.total_lines)+" 行",1)]),_:2},1024)]))),128))])):(i(),f("div",Ge,[e(q,{description:"暂无贡献者数据"})]))]),_:1})]),_:1})]),_:1}),e(O,{modelValue:k.value,"onUpdate:modelValue":t[5]||(t[5]=l=>k.value=l),title:`推送分支: ${m(_)}`,width:"480px","destroy-on-close":""},{footer:a(()=>[e(r,{onClick:t[4]||(t[4]=l=>k.value=!1)},{default:a(()=>[...t[19]||(t[19]=[o("取消",-1)])]),_:1}),e(r,{type:"primary",onClick:W},{default:a(()=>[...t[20]||(t[20]=[o("确认推送",-1)])]),_:1})]),default:a(()=>[e(I,{"label-width":"90px"},{default:a(()=>[e(x,{label:"目标远端"},{default:a(()=>[e(te,{modelValue:V.value,"onUpdate:modelValue":t[3]||(t[3]=l=>V.value=l)},{default:a(()=>[(i(!0),f(T,null,G(E.value,l=>(i(),z(ee,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"]),e(O,{modelValue:C.value,"onUpdate:modelValue":t[11]||(t[11]=l=>C.value=l),title:"提交变更",width:"550px","destroy-on-close":""},{footer:a(()=>[e(r,{onClick:t[10]||(t[10]=l=>C.value=!1)},{default:a(()=>[...t[21]||(t[21]=[o("取消",-1)])]),_:1}),e(r,{type:"primary",onClick:Y,loading:A.value},{default:a(()=>[...t[22]||(t[22]=[o("提交",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(I,{model:n.value,"label-width":"110px"},{default:a(()=>[e(x,{label:"Author Name"},{default:a(()=>[e(F,{modelValue:n.value.author_name,"onUpdate:modelValue":t[6]||(t[6]=l=>n.value.author_name=l)},null,8,["modelValue"])]),_:1}),e(x,{label:"Author Email"},{default:a(()=>[e(F,{modelValue:n.value.author_email,"onUpdate:modelValue":t[7]||(t[7]=l=>n.value.author_email=l)},null,8,["modelValue"])]),_:1}),e(x,{label:"Commit 信息",required:""},{default:a(()=>[e(F,{modelValue:n.value.message,"onUpdate:modelValue":t[8]||(t[8]=l=>n.value.message=l),type:"textarea",rows:3,placeholder:"请输入提交信息"},null,8,["modelValue"])]),_:1}),e(x,{label:"提交后推送"},{default:a(()=>[e(ae,{modelValue:n.value.push,"onUpdate:modelValue":t[9]||(t[9]=l=>n.value.push=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])),[[le,U.value]])}}}),et=Se(je,[["__scopeId","data-v-50ebc646"]]);export{et as default};
