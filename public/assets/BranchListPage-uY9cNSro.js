import{v as Ne,k as Pe,D as K,G as $,E as l,F as a,u as p,az as Fe,r as v,ac as d,y as s,S as o,am as Le,P as je,z as i,R as _,U as k,I as Ee,M as Q,a6 as ae,ad as Me,aB as qe}from"./vendor-BwpG93hR.js";import{e as Ke,g as Ie,k as te,p as Se,o as Ae,q as He,t as Ge,u as ne,w as Qe,v as Je,h as Oe,a as We,x as Xe,b as y,E as Ye}from"./element-plus-BS7CnCwq.js";import{g as J,a as Ze,b as oe,e as O,f as el,u as ll,h as al,c as tl}from"./branch-DTLR2Pkm.js";import{a as nl,s as ol,f as ul}from"./repo-DyMh5937.js";import{b as sl}from"./version-jTDAY5EQ.js";import{a as dl}from"./format-B53pSo0L.js";import{_ as il}from"./index-Bev_lS0N.js";import"./request-BBaptrTN.js";const rl={class:"branch-list-page"},ml={class:"page-header"},fl={class:"header-left"},pl={class:"header-actions"},vl={class:"table-footer"},cl=Ne({__name:"BranchListPage",setup(_l){const ue=Fe(),se=qe(),m=ue.params.repoKey,I=v(!1),S=v(!1),W=v([]),A=v([]),X=v(0),x=v("local"),H=v(""),L=v([]),T=v(!1),g=v({name:"",base_ref:""}),U=v(!1),h=v({old_name:"",new_name:""}),D=v(!1),G=v(""),N=v([]),P=v(!1),r=v({ref:"",name:"",message:"",push_remote:"",versionType:"patch"}),C=v(null);Pe(async()=>{await c();try{const n=await J(m,{type:"local",page_size:500});A.value=n.list||[]}catch{}try{const n=await nl(m);if(n?.path){const e=await ol(n.path);L.value=(e.remotes||[]).map(u=>u.name)}}catch{}});async function c(){I.value=!0;try{const n=await J(m,{type:x.value,keyword:H.value||void 0,page_size:500});W.value=n.list||[],X.value=n.total||0}finally{I.value=!1}}function B(n){const e=n.split("/");if(e.length<2)return null;const u=e.slice(1).join("/"),f=A.value.find(j=>j.name===u);return f?f.name:null}function de(n){se.push(`/repos/${m}/branches/${encodeURIComponent(n)}`)}async function ie(){S.value=!0;try{await ul(m),y.success("远端数据已刷新"),await c()}finally{S.value=!1}}async function re(n){try{await Ze(m,n),y.success(`已切换到 ${n}`),await c()}catch{}}async function me(n){const e=n.split("/"),u=e.length>=2?e.slice(1).join("/"):n;try{await oe({repo_key:m,name:u,base_ref:n}),y.success(`已检出为本地分支 ${u}`);const f=await J(m,{type:"local",page_size:500});A.value=f.list||[],await c()}catch{}}async function fe(n){const e=B(n);if(e)try{await O(m,e),y.success(`已更新本地分支 ${e}`),await c()}catch{}}async function pe(n){const e=B(n);if(e)try{await O(m,e),y.success(`已同步本地分支 ${e}`),await c()}catch{}}function ve(n){G.value=n;const e=L.value[0];N.value=e?[e]:[],D.value=!0}async function ce(){if(!N.value.length){y.warning("请选择目标远端");return}try{await el(m,G.value,N.value),y.success("推送成功"),D.value=!1,await c()}catch{}}async function _e(n){try{await O(m,n),y.success("拉取成功"),await c()}catch{}}async function ye(){if(!g.value.name){y.warning("请输入分支名称");return}try{await oe({repo_key:m,name:g.value.name,base_ref:g.value.base_ref||void 0}),y.success("分支创建成功"),T.value=!1,g.value={name:"",base_ref:""},await c()}catch{}}function be(n){h.value={old_name:n.name,new_name:n.name},U.value=!0}async function ke(){if(h.value.new_name)try{await ll(m,h.value.old_name,h.value.new_name),y.success("重命名成功"),U.value=!1,await c()}catch{}}async function ge(n){try{await Ye.confirm(`确定要删除分支 "${n}" 吗？`,"确认删除",{type:"warning"}),await al(m,n),y.success("分支已删除"),await c()}catch{}}function Ve(n){r.value={ref:n,name:"",message:"",push_remote:"",versionType:"patch"},C.value=null,P.value=!0,sl(m).then(e=>{C.value=e,Y("patch")}).catch(()=>{})}function Y(n){if(C.value)switch(n){case"patch":r.value.name=C.value.next_patch;break;case"minor":r.value.name=C.value.next_minor;break;case"major":r.value.name=C.value.next_major;break;case"custom":r.value.name="";break}}async function he(){if(!r.value.name){y.warning("请输入标签名");return}try{await tl({repo_key:m,name:r.value.name,ref:r.value.ref,message:r.value.message||void 0,push_remote:r.value.push_remote||void 0}),y.success("标签创建成功"),P.value=!1}catch{}}return(n,e)=>{const u=d("el-button"),f=d("el-icon"),j=d("el-tab-pane"),Ce=d("el-tabs"),w=d("el-input"),Z=d("el-col"),we=d("el-row"),ee=d("el-card"),z=d("el-table-column"),R=d("el-text"),F=d("el-tag"),le=d("el-button-group"),$e=d("el-table"),b=d("el-form-item"),E=d("el-form"),M=d("el-dialog"),xe=d("el-checkbox"),Be=d("el-checkbox-group"),ze=d("el-alert"),q=d("el-radio-button"),Re=d("el-radio-group"),Te=d("el-option"),Ue=d("el-select"),De=Me("loading");return s(),K("div",rl,[$("div",ml,[$("div",fl,[l(u,{onClick:e[0]||(e[0]=t=>n.$router.push(`/repos/${p(m)}`)),icon:p(Ke),text:""},{default:a(()=>[...e[21]||(e[21]=[o("返回",-1)])]),_:1},8,["icon"]),e[22]||(e[22]=$("h2",null,"分支管理",-1))]),$("div",pl,[l(u,{type:"success",onClick:e[1]||(e[1]=t=>n.$router.push(`/repos/${p(m)}/compare`))},{default:a(()=>[l(f,null,{default:a(()=>[l(p(Ie))]),_:1}),e[23]||(e[23]=o(" 分支对比 & 合并 ",-1))]),_:1}),l(u,{onClick:ie,loading:S.value},{default:a(()=>[l(f,null,{default:a(()=>[l(p(te))]),_:1}),e[24]||(e[24]=o(" 刷新远端 (Fetch) ",-1))]),_:1},8,["loading"]),l(u,{type:"primary",onClick:e[2]||(e[2]=t=>T.value=!0)},{default:a(()=>[l(f,null,{default:a(()=>[l(p(Se))]),_:1}),e[25]||(e[25]=o(" 新建分支 ",-1))]),_:1})])]),l(Ce,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=t=>x.value=t),onTabChange:c},{default:a(()=>[l(j,{label:"Local (本地分支)",name:"local"}),l(j,{label:"Remote (远端分支)",name:"remote"})]),_:1},8,["modelValue"]),l(ee,{class:"mb-3"},{default:a(()=>[l(we,{gutter:16},{default:a(()=>[l(Z,{span:8},{default:a(()=>[l(w,{modelValue:H.value,"onUpdate:modelValue":e[4]||(e[4]=t=>H.value=t),placeholder:"搜索分支名/作者...",onKeyup:Le(c,["enter"]),clearable:""},null,8,["modelValue"])]),_:1}),l(Z,{span:4},{default:a(()=>[l(u,{onClick:c},{default:a(()=>[...e[26]||(e[26]=[o("搜索",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(ee,null,{default:a(()=>[je((s(),i($e,{data:W.value,stripe:""},{default:a(()=>[l(z,{prop:"name",label:"分支名称","min-width":"180"},{default:a(({row:t})=>[$("span",{class:Ee({"branch-current":t.is_current})},[t.is_current?(s(),i(f,{key:0,color:"#67c23a"},{default:a(()=>[l(p(Ae))]),_:1})):_("",!0),o(" "+k(t.name),1)],2)]),_:1}),l(z,{prop:"hash",label:"最新提交","min-width":"200"},{default:a(({row:t})=>[l(R,{class:"mono-text",size:"small"},{default:a(()=>[o(k(t.hash?t.hash.substring(0,8):"-"),1)]),_:2},1024),t.message?(s(),i(R,{key:0,size:"small",type:"info",class:"commit-msg",truncated:""},{default:a(()=>[o(k(t.message),1)]),_:2},1024)):_("",!0)]),_:1}),l(z,{prop:"author",label:"提交人",width:"140"},{default:a(({row:t})=>[$("div",null,k(t.author),1),t.author_email?(s(),i(R,{key:0,size:"small",type:"info"},{default:a(()=>[o(k(t.author_email),1)]),_:2},1024)):_("",!0)]),_:1}),l(z,{prop:"date",label:"提交时间",width:"160"},{default:a(({row:t})=>[o(k(p(dl)(t.date)),1)]),_:1}),x.value==="local"?(s(),i(z,{key:0,label:"状态",width:"140"},{default:a(({row:t})=>[t.upstream?(s(),K(Q,{key:0},[t.ahead>0?(s(),i(F,{key:0,size:"small",type:"success"},{default:a(()=>[o(k(t.ahead)+"↑",1)]),_:2},1024)):_("",!0),t.behind>0?(s(),i(F,{key:1,size:"small",type:"warning"},{default:a(()=>[o(k(t.behind)+"↓",1)]),_:2},1024)):_("",!0),t.ahead===0&&t.behind===0?(s(),i(F,{key:2,size:"small",type:"info"},{default:a(()=>[...e[27]||(e[27]=[o("已同步",-1)])]),_:1})):_("",!0)],64)):(s(),i(R,{key:1,type:"info",size:"small"},{default:a(()=>[...e[28]||(e[28]=[o("无上游",-1)])]),_:1}))]),_:1})):_("",!0),x.value==="remote"?(s(),i(z,{key:1,label:"关联",width:"160"},{default:a(({row:t})=>[B(t.name)?(s(),i(F,{key:0,size:"small",type:"success"},{default:a(()=>[o(" 已关联: "+k(B(t.name)),1)]),_:2},1024)):(s(),i(R,{key:1,type:"info",size:"small"},{default:a(()=>[...e[29]||(e[29]=[o("无本地关联",-1)])]),_:1}))]),_:1})):_("",!0),l(z,{label:"操作",width:x.value==="local"?340:280,fixed:"right"},{default:a(({row:t})=>[x.value==="local"?(s(),i(le,{key:0,size:"small"},{default:a(()=>[t.is_current?_("",!0):(s(),i(u,{key:0,onClick:V=>re(t.name)},{default:a(()=>[l(f,null,{default:a(()=>[l(p(He))]),_:1}),e[30]||(e[30]=o(" 切换 ",-1))]),_:1},8,["onClick"])),l(u,{onClick:V=>ve(t.name)},{default:a(()=>[l(f,null,{default:a(()=>[l(p(Ge))]),_:1}),e[31]||(e[31]=o(" 推送 ",-1))]),_:1},8,["onClick"]),l(u,{onClick:V=>_e(t.name)},{default:a(()=>[l(f,null,{default:a(()=>[l(p(ne))]),_:1}),e[32]||(e[32]=o(" 拉取 ",-1))]),_:1},8,["onClick"]),l(u,{onClick:V=>Ve(t.name),type:"warning"},{default:a(()=>[l(f,null,{default:a(()=>[l(p(Qe))]),_:1})]),_:1},8,["onClick"]),l(u,{type:"primary",onClick:V=>de(t.name)},{default:a(()=>[l(f,null,{default:a(()=>[l(p(Je))]),_:1}),e[33]||(e[33]=o(" 详情 ",-1))]),_:1},8,["onClick"]),l(u,{onClick:V=>be(t)},{default:a(()=>[l(f,null,{default:a(()=>[l(p(Oe))]),_:1})]),_:1},8,["onClick"]),t.is_current?_("",!0):(s(),i(u,{key:1,type:"danger",onClick:V=>ge(t.name)},{default:a(()=>[l(f,null,{default:a(()=>[l(p(We))]),_:1})]),_:1},8,["onClick"]))]),_:2},1024)):(s(),i(le,{key:1,size:"small"},{default:a(()=>[B(t.name)?_("",!0):(s(),i(u,{key:0,type:"primary",onClick:V=>me(t.name)},{default:a(()=>[l(f,null,{default:a(()=>[l(p(te))]),_:1}),e[34]||(e[34]=o(" 检出为本地 ",-1))]),_:1},8,["onClick"])),B(t.name)?(s(),i(u,{key:1,onClick:V=>fe(t.name)},{default:a(()=>[l(f,null,{default:a(()=>[l(p(ne))]),_:1}),e[35]||(e[35]=o(" 更新本地 ",-1))]),_:1},8,["onClick"])):_("",!0),B(t.name)?(s(),i(u,{key:2,onClick:V=>pe(t.name)},{default:a(()=>[l(f,null,{default:a(()=>[l(p(Xe))]),_:1}),e[36]||(e[36]=o(" 同步本地 ",-1))]),_:1},8,["onClick"])):_("",!0)]),_:2},1024))]),_:1},8,["width"])]),_:1},8,["data"])),[[De,I.value]]),$("div",vl,[l(R,{type:"info",size:"small"},{default:a(()=>[o("共 "+k(X.value)+" 个分支",1)]),_:1})])]),_:1}),l(M,{modelValue:T.value,"onUpdate:modelValue":e[8]||(e[8]=t=>T.value=t),title:"新建分支",width:"480px","destroy-on-close":""},{footer:a(()=>[l(u,{onClick:e[7]||(e[7]=t=>T.value=!1)},{default:a(()=>[...e[38]||(e[38]=[o("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:ye},{default:a(()=>[...e[39]||(e[39]=[o("创建",-1)])]),_:1})]),default:a(()=>[l(E,{model:g.value,"label-width":"110px"},{default:a(()=>[l(b,{label:"新分支名称",required:""},{default:a(()=>[l(w,{modelValue:g.value.name,"onUpdate:modelValue":e[5]||(e[5]=t=>g.value.name=t)},null,8,["modelValue"])]),_:1}),l(b,{label:"基于 (Base Ref)"},{default:a(()=>[l(w,{modelValue:g.value.base_ref,"onUpdate:modelValue":e[6]||(e[6]=t=>g.value.base_ref=t),placeholder:"默认为当前 HEAD"},null,8,["modelValue"]),e[37]||(e[37]=$("div",{class:"form-tip"},"可以是分支名、标签或 Commit Hash",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(M,{modelValue:U.value,"onUpdate:modelValue":e[11]||(e[11]=t=>U.value=t),title:"重命名分支",width:"480px","destroy-on-close":""},{footer:a(()=>[l(u,{onClick:e[10]||(e[10]=t=>U.value=!1)},{default:a(()=>[...e[40]||(e[40]=[o("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:ke},{default:a(()=>[...e[41]||(e[41]=[o("保存",-1)])]),_:1})]),default:a(()=>[l(E,{model:h.value,"label-width":"90px"},{default:a(()=>[l(b,{label:"当前名称"},{default:a(()=>[l(w,{"model-value":h.value.old_name,disabled:""},null,8,["model-value"])]),_:1}),l(b,{label:"新名称",required:""},{default:a(()=>[l(w,{modelValue:h.value.new_name,"onUpdate:modelValue":e[9]||(e[9]=t=>h.value.new_name=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(M,{modelValue:D.value,"onUpdate:modelValue":e[14]||(e[14]=t=>D.value=t),title:`推送分支: ${G.value}`,width:"480px","destroy-on-close":""},{footer:a(()=>[l(u,{onClick:e[13]||(e[13]=t=>D.value=!1)},{default:a(()=>[...e[43]||(e[43]=[o("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:ce},{default:a(()=>[...e[44]||(e[44]=[o("确认推送",-1)])]),_:1})]),default:a(()=>[l(E,{"label-width":"90px"},{default:a(()=>[l(b,{label:"目标远端"},{default:a(()=>[l(Be,{modelValue:N.value,"onUpdate:modelValue":e[12]||(e[12]=t=>N.value=t)},{default:a(()=>[(s(!0),K(Q,null,ae(L.value,t=>(s(),i(xe,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(ze,{type:"info",closable:!1,"show-icon":""},{default:a(()=>[...e[42]||(e[42]=[o(" 推送操作将把本地分支更新推送到选定的远端仓库。 ",-1)])]),_:1})]),_:1},8,["modelValue","title"]),l(M,{modelValue:P.value,"onUpdate:modelValue":e[20]||(e[20]=t=>P.value=t),title:"打标签 (Tag)",width:"550px","destroy-on-close":""},{footer:a(()=>[l(u,{onClick:e[19]||(e[19]=t=>P.value=!1)},{default:a(()=>[...e[49]||(e[49]=[o("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:he},{default:a(()=>[...e[50]||(e[50]=[o("创建",-1)])]),_:1})]),default:a(()=>[l(E,{model:r.value,"label-width":"100px"},{default:a(()=>[l(b,{label:"目标引用"},{default:a(()=>[l(w,{"model-value":r.value.ref,disabled:""},null,8,["model-value"])]),_:1}),l(b,{label:"版本类型"},{default:a(()=>[l(Re,{modelValue:r.value.versionType,"onUpdate:modelValue":e[15]||(e[15]=t=>r.value.versionType=t),onChange:Y},{default:a(()=>[l(q,{value:"patch"},{default:a(()=>[...e[45]||(e[45]=[o("Patch",-1)])]),_:1}),l(q,{value:"minor"},{default:a(()=>[...e[46]||(e[46]=[o("Minor",-1)])]),_:1}),l(q,{value:"major"},{default:a(()=>[...e[47]||(e[47]=[o("Major",-1)])]),_:1}),l(q,{value:"custom"},{default:a(()=>[...e[48]||(e[48]=[o("自定义",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),C.value?(s(),i(b,{key:0,label:"当前版本"},{default:a(()=>[l(F,{type:"info",size:"small"},{default:a(()=>[o(k(C.value.current||"无"),1)]),_:1})]),_:1})):_("",!0),l(b,{label:"标签名",required:""},{default:a(()=>[l(w,{modelValue:r.value.name,"onUpdate:modelValue":e[16]||(e[16]=t=>r.value.name=t),disabled:r.value.versionType!=="custom",placeholder:"v1.0.0"},null,8,["modelValue","disabled"])]),_:1}),l(b,{label:"说明"},{default:a(()=>[l(w,{modelValue:r.value.message,"onUpdate:modelValue":e[17]||(e[17]=t=>r.value.message=t),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),l(b,{label:"推送到远端"},{default:a(()=>[l(Ue,{modelValue:r.value.push_remote,"onUpdate:modelValue":e[18]||(e[18]=t=>r.value.push_remote=t),placeholder:"不推送",clearable:""},{default:a(()=>[(s(!0),K(Q,null,ae(L.value,t=>(s(),i(Te,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),$l=il(cl,[["__scopeId","data-v-96c2612b"]]);export{$l as default};
